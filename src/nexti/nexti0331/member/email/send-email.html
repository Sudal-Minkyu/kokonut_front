<?php
include_once('../common/header.html');
?>
	
	<!-- 단일 캘린더 스크립트 -->
	<script src="https://code.jquery.com/jquery-3.6.0.js"></script>
	<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
	
	<section class="bodyWrap">
		<div class="contentInnerWrap">
			<div class="pageTitleBtn marB50">
				<h1>이메일 발송</h1>
				<!-- 이메일 발송 완료 페이지 테스트 확인 페이지 링크 -->
				<a href="mail-send-complete.html" class="marR30">메일발송 완료 페이지</a>
				<a href="mail-reserve-send-complete.html">메일예약발송 완료 페이지</a>
			</div>
			<!-- 이메일 발송 영역 -->
			<div class="semailWrap">
				<form>
					<div>
						<div class="semBtnBox">
							<div><button type="submit" class="semBtn">발송하기</button></div>
							<div class="mail_reserveBtn">예약</div>
						</div>
						<!-- 이메일 예약 팝업 영역 -->
						<div class="mail_reserveBox">
							<div class="mrTopBox">
								<div class="mrTopTitle marB12">발송 예약</div>
								<div class="mrtContent marB12 mrtType01">
									<dl>기준시간</dl>
									<div class="mrtBox">
										<div class="mrtSelBox">
											<div class="selectBox wid100per nonePad">
												<div class="label" id="standardTime">전체</div>
												<ul class="optionList">
													<li class="optionItem curv">항목1</li>
													<li class="optionItem curv">항목2</li>
												</ul>
											</div>
										</div>
									</div>
								</div>
								<div class="mrtContent mrtType02">
									<dl>예약시간</dl>
									<div class="mrtBox">
										<div class="time_input">
											<input type="text" name="startdate" id="datepicker" class="" placeholder="시작일" autocomplete="off" maxlength="10" value="">
										</div>
										<div class="mrtSelBox">
											<div class="selectBox wid100per nonePad">
												<div class="label" id="timeSelection">시간선택</div>
												<ul class="optionList">
													<li class="optionItem curv">1시</li>
													<li class="optionItem curv">2시</li>
													<li class="optionItem curv">3시</li>
													<li class="optionItem curv">4시</li>
													<li class="optionItem curv">5시</li>
													<li class="optionItem curv">6시</li>
													<li class="optionItem curv">7시</li>
													<li class="optionItem curv">8시</li>
													<li class="optionItem curv">9시</li>
													<li class="optionItem curv">10시</li>
													<li class="optionItem curv">11시</li>
													<li class="optionItem curv">12시</li>
													<li class="optionItem curv">13시</li>
													<li class="optionItem curv">14시</li>
													<li class="optionItem curv">15시</li>
													<li class="optionItem curv">16시</li>
													<li class="optionItem curv">17시</li>
													<li class="optionItem curv">18시</li>
													<li class="optionItem curv">19시</li>
													<li class="optionItem curv">20시</li>
													<li class="optionItem curv">21시</li>
													<li class="optionItem curv">22시</li>
													<li class="optionItem curv">23시</li>
													<li class="optionItem curv">24시</li>
												</ul>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="mrBottomBox">
								<div class="floatBtnBox">
									<div class="del mailreserve_cancal" id="">취소</div>
									<div class="add mailreserve_confirm" id="">확인</div>
								</div>
							</div>
						</div>
						<!-- 이메일 예약 선택된 정보 영역 -->
						<div class="cur_reserve marT16">
							<p>예약</p>
							<dl><span>2023. 03. 20</span> <span>(월)</span> <span>14:00</span></dl>
							<div class="reserve_close" id=""></div>
						</div>
					</div>
					<script>
						// 이메일 예약 팝업 버튼 스크립트
						$(".mail_reserveBtn").click(function(){			
							$('.mail_reserveBox').show();	
						});
						$(".mailreserve_cancal").click(function(){
							document.getElementById('standardTime').innerText = '전체';
							$('#datepicker').val('');
							document.getElementById('timeSelection').innerText = '시간선택';
							$('.mail_reserveBox').hide();
						});
						$(".mailreserve_confirm").click(function(){			
							$('.mail_reserveBox').hide();	
						});
					</script>
					
					<div class="semailContentBox marT24">
						<div class="semailitemBox marB20">
							<dl>발송목적</dl>
							<div class="se_item seselCont">
								<div class="selectBox wid122 nonePad">
									<div class="label" id="">선택</div>
									<ul class="optionList">
										<li class="optionItem curv">주요공지</li>
										<li class="optionItem curv">광고/홍보</li>
									</ul>
								</div>
							</div>
						</div>
						<div class="semailitemBox marB20">
							<dl>발송대상</dl>
							<div class="se_item seradio">
								<div class="popRadio">
									<div class="check poprCheck">
										<input type="radio" class="radio" name="use_noneuse" id="전체 회원" value="전체 회원" checked="">
										<label for="전체 회원">
											<em><dt></dt></em>
											전체 회원
											<span>500명</span>
										</label>
									</div>
									<div class="check poprCheck">
										<input type="radio" class="radio" name="use_noneuse" id="선택 회원" value="선택 회원">
										<label for="선택 회원">
											<em><dt></dt></em>
											선택 회원
											<span>20명</span>
											<div class="sendMemberBtn" id="email_member_pop">회원선택</div>
										</label>
									</div>
								</div>
							</div>
						</div>
						<div class="semailitemBox marB20">
							<dl>발신자 설정</dl>
							<div class="se_item ">
								<input type="text" name="" id="" placeholder="발신자의 이메일을 적어주세요."></input>
							</div>
						</div>
						<div class="semailitemBox marB20">
							<dl>제목</dl>
							<div class="se_item ">
								<input type="text" name="" id="" placeholder="제목을 적어주세요."></input>
							</div>
						</div>
						<div class="semailitemBox sefileCont">
							<dl>파일첨부</dl>
							<div class="se_item">
								<div class="sc_fileBox">
									<div class="fileInner">
										<div class="file-list"></div>
										<label for="file">첨부</label>
										<input type="file" id="file" onchange="addFile(this);" multiple />
									</div>
								</div>
							</div>
						</div>
						
						<div class="writeToolBox marT40">
							<img src="/kokonut/member/public/img/common/writetool_testimg.png" alt="" style="max-width:100%;">
						</div>
						
					</div>
				</form>
				<div class="bottomInfoBox marT24">
					<dl>광고/홍보 목적의 메시지 발송은 반드시 수신 허용한 회원에게만 발송해야 합니다. (개인정보 보호법)</dl>
					<dl>회원정보 DB항목 중 광고/홍보 수신설정 항목이 없는 경우 광고/홍보를 선택할 수 없으며, 임의로 광고/홍보 메시지 발송 시 모든 책임은 관리담당자에게 있습니다.</dl>
				</div>
			</div>
		</div>
	</section>
	
	<!-- [D] 회원선택 팝업 -->
	<div class="koko_popup email_member_pop" data-popup="email_member_pop">
		<div class="koko_popup_inner">
			<div class="koko_popup_container">
				<div class="koko_popup_title">
					<h3 class="">회원선택 <span>11</span></h3>
				</div>
				
				<div class="memselBox marB36">
					<div class="memName">김코코(인사팀)<button class="memdel"></button></div>
					<div class="memName">정코코(인사팀)<button class="memdel"></button></div>
					<div class="memName">최코코(인사팀)<button class="memdel"></button></div>
					<div class="memName">박코코(인사팀)<button class="memdel"></button></div>
					<div class="memName">이코코(인사팀)<button class="memdel"></button></div>
					<div class="memName">오코코(인사팀)<button class="memdel"></button></div>
					<div class="memName">한코코(인사팀)<button class="memdel"></button></div>
					<div class="memName">박코코(인사팀)<button class="memdel"></button></div>
					<div class="memName">강코코(인사팀)<button class="memdel"></button></div>
					<div class="memName">장코코(인사팀)<button class="memdel"></button></div>
					<div class="memName">주코코(인사팀)<button class="memdel"></button></div>
				</div>
				
				<div class="memseaBox marB24">
					<div class="koinput">
						<input type="text" name="" id="" class="wid210" placeholder="아이디, 이름 검색">
						<button><img src="/kokonut/member/public/img/common/icon_search_ver2.png" alt=""></button>
					</div>
					<div class="mu_SelBox wid130">
						<div class="selectBox wid100per nonePad">
							<div class="label" id="">부서</div>
							<ul class="optionList">
								<li class="optionItem">부서명1</li>
								<li class="optionItem">부서명2</li>
								<li class="optionItem">부서명3</li>
								<li class="optionItem">부서명4</li>
							</ul>
						</div>
					</div>
					<div class="mu_SelBox wid150">
						<div class="selectBox wid100per nonePad">
							<div class="label popgrade" id="">관리자 등급</div>
							<ul class="optionList">
								<li class="optionItem popanoGrade">게스트</li>
								<li class="optionItem popanoGrade">관리자</li>
								<li class="optionItem popanoGrade">최고관리자</li>
								<li class="optionItem popmasterSel">최고관리자<span></span></li>
							</ul>
						</div>
					</div>
					<script>
					$('.popmasterSel').on('click', function() {
						$('.popgrade').addClass('popmaster');
					});
					$('.popanoGrade').on('click', function() {
						$('.popgrade').removeClass('popmaster');
					});
					</script>
				</div>
				
				<div class="emailtableWrap">
					<div class="kt_tableTopBox marB16">
						<div class="kt_total">총 <span>11</span>건</div>
						<div class="kt_selbox wid108">
							<div class="selectBox wid100per nonePad">
								<div class="label" id="">최근 등록순</div>
								<ul class="optionList">
									<li class="optionItem">최근 등록순</li>
									<li class="optionItem">정확도순</li>
									<li class="optionItem">오름차순</li>
									<li class="optionItem">내림차순</li>
								</ul>
							</div>
						</div>
					</div>
					<div class="emailtableBox">
						<div class="prtable">
							<table>
								<colgroup>
									<col style="width:7.27%;">
									<col style="width:41.82%;">
									<col style="width:14.55%;">
									<col style="width:14.55%;">
									<col style="width:21.82%;">
								</colgroup>
								<thead>
									<tr>
										<th>
											<div class="koko_check">
												<input type="checkbox" name="allcheck" id="allcheck">
												<label for="allcheck"><em></em></label>
											</div>
										</th>
										<th>아이디</th>
										<th>이름</th>
										<th>부서</th>
										<th>관리자 등급</th>
									</tr>    
								</thead>
								<tbody>
									<tr>
										<td>
											<div class="koko_check">
												<input type="checkbox" value="" name="mem01" id="mem01" class="partcheck">
												<label for="mem01"><em></em></label>
											</div>
										</td>
										<td>koko1@kokonut.me</td>
										<td>김코코</td>
										<td>인사팀</td>
										<td>최고관리자</td>
									</tr>
									<tr>
										<td>
											<div class="koko_check">
												<input type="checkbox" value="" name="mem02" id="mem02" class="partcheck">
												<label for="mem02"><em></em></label>
											</div>
										</td>
										<td>koko1@kokonut.me</td>
										<td>김코코</td>
										<td>인사팀</td>
										<td>최고관리자</td>
									</tr>
									<tr>
										<td>
											<div class="koko_check">
												<input type="checkbox" value="" name="mem03" id="mem03" class="partcheck">
												<label for="mem03"><em></em></label>
											</div>
										</td>
										<td>koko1@kokonut.me</td>
										<td>김코코</td>
										<td>인사팀</td>
										<td>최고관리자</td>
									</tr>
									<tr>
										<td>
											<div class="koko_check">
												<input type="checkbox" value="" name="mem04" id="mem04" class="partcheck">
												<label for="mem04"><em></em></label>
											</div>
										</td>
										<td>koko1@kokonut.me</td>
										<td>김코코</td>
										<td>인사팀</td>
										<td>최고관리자</td>
									</tr>
									<tr>
										<td>
											<div class="koko_check">
												<input type="checkbox" value="" name="mem05" id="mem05" class="partcheck">
												<label for="mem05"><em></em></label>
											</div>
										</td>
										<td>koko1@kokonut.me</td>
										<td>김코코</td>
										<td>인사팀</td>
										<td>최고관리자</td>
									</tr>
									<tr>
										<td>
											<div class="koko_check">
												<input type="checkbox" value="" name="mem06" id="mem06" class="partcheck">
												<label for="mem06"><em></em></label>
											</div>
										</td>
										<td>koko1@kokonut.me</td>
										<td>김코코</td>
										<td>인사팀</td>
										<td>최고관리자</td>
									</tr>
									<tr>
										<td>
											<div class="koko_check">
												<input type="checkbox" value="" name="mem07" id="mem07" class="partcheck">
												<label for="mem07"><em></em></label>
											</div>
										</td>
										<td>koko1@kokonut.me</td>
										<td>김코코</td>
										<td>인사팀</td>
										<td>최고관리자</td>
									</tr>
									<tr>
										<td>
											<div class="koko_check">
												<input type="checkbox" value="" name="mem08" id="mem08" class="partcheck">
												<label for="mem08"><em></em></label>
											</div>
										</td>
										<td>koko1@kokonut.me</td>
										<td>김코코</td>
										<td>인사팀</td>
										<td>최고관리자</td>
									</tr>
									<tr>
										<td>
											<div class="koko_check">
												<input type="checkbox" value="" name="mem09" id="mem09" class="partcheck">
												<label for="mem09"><em></em></label>
											</div>
										</td>
										<td>koko1@kokonut.me</td>
										<td>김코코</td>
										<td>인사팀</td>
										<td>최고관리자</td>
									</tr>
									<tr>
										<td>
											<div class="koko_check">
												<input type="checkbox" value="" name="mem10" id="mem10" class="partcheck">
												<label for="mem10"><em></em></label>
											</div>
										</td>
										<td>koko1@kokonut.me</td>
										<td>김코코</td>
										<td>인사팀</td>
										<td>최고관리자</td>
									</tr>
									<tr>
										<td>
											<div class="koko_check">
												<input type="checkbox" value="" name="mem11" id="mem11" class="partcheck">
												<label for="mem11"><em></em></label>
											</div>
										</td>
										<td>koko1@kokonut.me</td>
										<td>김코코</td>
										<td>인사팀</td>
										<td>최고관리자</td>
									</tr>
								</tbody>
							</table>
							<script>
							// 체크박스 스크립트
							$("#allcheck").click(function(){
								if($("#allcheck").is(":checked")){
									$(".partcheck").prop("checked",true);
								}
								else{
									$(".partcheck").prop("checked",false);
								}
							});
							</script>
						</div>	
					</div>
				</div>
					
				<div class="kokopopBtnBox">
					<div class="koko_cancel email_member_pop_close">취소</div>
					<div class="koko_go"><button type="submit">선택</button></div>
				</div>
			</div>
			<div class="koko-popup-close email_member_pop_close" data-popup-close="email_member_pop_close"></div>
		</div>
	</div>
	<!-- // [D] 회원선택 팝업 -->
	
	<script>
	//----- 회원선택 OPEN / CLOSE
	$('#email_member_pop').on('click', function() {
		$('[data-popup="email_member_pop"]').fadeIn(0);
		$('body').css('overflow','hidden');
	});
	$('.email_member_pop_close').on('click', function() {
		$('[data-popup="email_member_pop"]').fadeOut(0);
		$('body').css('overflow','unset');
	});
	</script>
	
	<script>
	$(function() {
		//모든 datepicker에 대한 공통 옵션 설정
		$.datepicker.setDefaults({
			dateFormat: 'yy. mm. dd' //Input Display Format 변경
			,showOtherMonths: true //빈 공간에 현재월의 앞뒤월의 날짜를 표시
			,showMonthAfterYear:true //년도 먼저 나오고, 뒤에 월 표시
			,changeYear: true //콤보박스에서 년 선택 가능
			,changeMonth: true //콤보박스에서 월 선택 가능                
			,showOn: "both" //button:버튼을 표시하고,버튼을 눌러야만 달력 표시 ^ both:버튼을 표시하고,버튼을 누르거나 input을 클릭하면 달력 표시  
			,buttonImage: "/kokonut/member/public/img/common/callendericon.png" //버튼 이미지 경로
			,buttonImageOnly: true //기본 버튼의 회색 부분을 없애고, 이미지만 보이게 함
			,buttonText: "선택" //버튼에 마우스 갖다 댔을 때 표시되는 텍스트                
			,yearSuffix: "" //달력의 년도 부분 뒤에 붙는 텍스트
			,monthNamesShort: ['1','2','3','4','5','6','7','8','9','10','11','12'] //달력의 월 부분 텍스트
			,monthNames: ['1월','2월','3월','4월','5월','6월','7월','8월','9월','10월','11월','12월'] //달력의 월 부분 Tooltip 텍스트
			,dayNamesMin: ['일','월','화','수','목','금','토'] //달력의 요일 부분 텍스트
			,dayNames: ['일요일','월요일','화요일','수요일','목요일','금요일','토요일'] //달력의 요일 부분 Tooltip 텍스트
			,minDate: "-5Y" //최소 선택일자(-1D:하루전, -1M:한달전, -1Y:일년전)
			,maxDate: "+5Y" //최대 선택일자(+1D:하루후, -1M:한달후, -1Y:일년후)
		});

		//input을 datepicker로 선언
		$("#datepicker").datepicker();                    
		$("#datepicker2").datepicker();
		
		//From의 초기값을 오늘 날짜로 설정
		//$('#datepicker').datepicker('setDate', '-7D'); //(-1D:하루전, -1M:한달전, -1Y:일년전), (+1D:하루후, -1M:한달후, -1Y:일년후)
		//To의 초기값을 내일로 설정
		//$('#datepicker2').datepicker('setDate', 'today'); //(-1D:하루전, -1M:한달전, -1Y:일년전), (+1D:하루후, -1M:한달후, -1Y:일년후)
	});
	</script>
	
	<script>
		var fileNo = 0;
		var filesArr = new Array();

		/* 첨부파일 추가 */
		function addFile(obj){
			var maxFileCnt = 5;   // 첨부파일 최대 개수
			var attFileCnt = document.querySelectorAll('.filebox').length;    // 기존 추가된 첨부파일 개수
			var remainFileCnt = maxFileCnt - attFileCnt;    // 추가로 첨부가능한 개수
			var curFileCnt = obj.files.length;  // 현재 선택된 첨부파일 개수

			// 첨부파일 개수 확인
			if (curFileCnt > remainFileCnt) {
				alert("첨부파일은 최대 " + maxFileCnt + "개 까지 첨부 가능합니다.");
			}

			for (var i = 0; i < Math.min(curFileCnt, remainFileCnt); i++) {

				const file = obj.files[i];

				// 첨부파일 검증
				if (validation(file)) {
					// 파일 배열에 담기
					var reader = new FileReader();
					reader.onload = function () {
						filesArr.push(file);
					};
					reader.readAsDataURL(file)

					// 목록 추가
					let htmlData = '';
					htmlData += '<div id="file' + fileNo + '" class="filebox">';
					htmlData += '   <p class="name">' + file.name + '</p>';
					htmlData += '   <div class="delete" onclick="deleteFile(' + fileNo + ');"></div>';
					htmlData += '</div>';
					$('.file-list').append(htmlData);
					fileNo++;
				} else {
					continue;
				}
			}
			// 초기화
			document.querySelector("input[type=file]").value = "";
		}

		/* 첨부파일 검증 */
		function validation(obj){
			const fileTypes = ['application/pdf', 'image/gif', 'image/jpeg', 'image/png', 'image/bmp', 'image/tif', 'application/haansofthwp', 'application/x-hwp'];
			if (obj.name.length > 100) {
				alert("파일명이 100자 이상인 파일은 제외되었습니다.");
				return false;
			} else if (obj.size > (100 * 1024 * 1024)) {
				alert("최대 파일 용량인 100MB를 초과한 파일은 제외되었습니다.");
				return false;
			} else if (obj.name.lastIndexOf('.') == -1) {
				alert("확장자가 없는 파일은 제외되었습니다.");
				return false;
			} else if (!fileTypes.includes(obj.type)) {
				alert("첨부가 불가능한 파일은 제외되었습니다.");
				return false;
			} else {
				return true;
			}
		}

		/* 첨부파일 삭제 */
		function deleteFile(num) {
			document.querySelector("#file" + num).remove();
			filesArr[num].is_delete = true;
		}

		/* 폼 전송 */
		function submitForm() {
			// 폼데이터 담기
			var form = document.querySelector("form");
			var formData = new FormData(form);
			for (var i = 0; i < filesArr.length; i++) {
				// 삭제되지 않은 파일만 폼데이터에 담기
				if (!filesArr[i].is_delete) {
					formData.append("attach_file", filesArr[i]);
				}
			}

			$.ajax({
				method: 'POST',
				url: '/register',
				dataType: 'json',
				data: formData,
				async: true,
				timeout: 30000,
				cache: false,
				headers: {'cache-control': 'no-cache', 'pragma': 'no-cache'},
				success: function () {
					alert("파일업로드 성공");
				},
				error: function (xhr, desc, err) {
					alert('에러가 발생 하였습니다.');
					return;
				}
			})
		}
	</script>
	
<?php
include_once('../common/footer.html');
?>		